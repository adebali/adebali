
<!DOCTYPE html>
<html lang='en' xml:lang='en' xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <meta content='text/html;charset=UTF-8' http-equiv='content-type'>
    <title>Right-angle phylograms and dendrograms with d3</title>
    <script src="http://d3js.org/d3.v3.min.js" type="text/javascript"></script>
    <script src="newick.js" type="text/javascript"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="d3.phylogram2.js" type="text/javascript"></script>
    <script>

	function getUrlVars() {
		var vars = {};
		var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,
		function(m,key,value) {
			vars[key] = value;
			});
		return vars;
		}

	var vars = getUrlVars();

	var nwkFile = 'newick' in vars ? vars['newick'] : "npc1_rm2ce.fa..phy_phyml_trec.nwk";
	var jsonFile = 'json' in vars ? vars['json'] : "npc1_rm2ce.json";
	var fastaFile = 'fasta' in vars ? vars['fasta'] : "NA";
	var firstSeqWord = 'first' in vars ? vars['first'] : "sapiens";

	console.log(vars);
		
	var nwk = '';
	$.ajax({
	  url: nwkFile,
	  type: "GET",
	  data: {},
	  async: false,
	  success: function(data){nwk = data;},
	  dataType: "text"
	});

	function load() {
		var newick = Newick.parse(nwk);
		
		var newickNodes = [];
		function buildNewickNodes(node, callback) {
		  newickNodes.push(node)
		  if (node.branchset) {
		    for (var i=0; i < node.branchset.length; i++) {
		      buildNewickNodes(node.branchset[i])
		    }
		  }
		}
		buildNewickNodes(newick)
	       
		alignment = jsonFile;
	
		d3.json(alignment,function(error, alignmentData) { 
			console.log(alignmentData);
			d3.phylogram.buildRadial(alignmentData,'#radialtree', newick, {width: 40, skipLabels: true});
		
			d3.phylogram.build(alignmentData,'#phylogram', newick, {
			  width: 300,
			  height: 8200
			});
		});
	    }




    </script>
    <style type="text/css" media="screen">
      body { font-family: "Helvetica Neue", Helvetica, sans-serif; }
      td { vertical-align: top; }
    </style>
  </head>
  <body onload="load()">
    <div id=info></div>
    <div id=input></div>
    <table>
      <tr>
        <td id="unseen">
          <h2></h2>
          <div id='radialtree'></div>
        </td>
        <td>
          <h2>Phylogram</h2>
          <div id='phylogram'></div>
        </td>
      </tr>
    </table>
  </body>

  <script>
	document.getElementById("unseen").style.visibility="hidden";
	mutationInput();
  </script>
</html>

